No arquivo app/routes/super_admin.py, SUBSTITUA a função delete_agencia por:

@router.delete("/agencias/{agencia_id}")
async def delete_agencia(
    agencia_id: str,
    current_user: dict = Depends(require_super_admin)
):
    """Deleta uma agência e todos os dados relacionados, incluindo usuários."""
    logger.info(f"Super Admin {current_user['email']} deletando agência: {agencia_id}")

    supabase = get_supabase_client()

    try:
        # Verificar se agência existe
        agencia = supabase.table("agencias").select("id, nome").eq("id", agencia_id).execute()
        
        if not agencia.data:
            raise HTTPException(status_code=404, detail="Agência não encontrada")
        
        nome_agencia = agencia.data[0].get("nome", "")
        
        # Contar usuários que serão deletados
        usuarios = supabase.table("usuarios").select("id").eq("agencia_id", agencia_id).execute()
        total_usuarios = len(usuarios.data) if usuarios.data else 0
        
        # 1. Deletar usuários da agência
        supabase.table("usuarios").delete().eq("agencia_id", agencia_id).execute()
        logger.info(f"{total_usuarios} usuários deletados da agência {agencia_id}")
        
        # 2. Deletar mensagens das conversas da agência
        conversas = supabase.table("conversas").select("id").eq("agencia_id", agencia_id).execute()
        if conversas.data:
            conversa_ids = [c["id"] for c in conversas.data]
            for cid in conversa_ids:
                supabase.table("mensagens").delete().eq("conversa_id", cid).execute()
            logger.info(f"Mensagens deletadas de {len(conversa_ids)} conversas")
        
        # 3. Deletar conversas da agência
        supabase.table("conversas").delete().eq("agencia_id", agencia_id).execute()
        logger.info(f"Conversas deletadas da agência {agencia_id}")
        
        # 4. Deletar notificações da agência
        try:
            supabase.table("notificacoes_config").delete().eq("agencia_id", agencia_id).execute()
        except:
            pass
        
        # 5. Deletar integrações CRM
        try:
            supabase.table("integracoes_crm").delete().eq("agencia_id", agencia_id).execute()
        except:
            pass
        
        # 6. Finalmente deletar a agência
        response = supabase.table("agencias").delete().eq("id", agencia_id).execute()

        if response.data:
            logger.info(f"Agência {nome_agencia} deletada com sucesso")
            return {
                "success": True, 
                "message": f"Agência '{nome_agencia}' deletada com sucesso",
                "usuarios_deletados": total_usuarios
            }

        raise HTTPException(status_code=500, detail="Erro ao deletar agência")

    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Erro ao deletar agência: {e}")
        raise HTTPException(status_code=500, detail=str(e))