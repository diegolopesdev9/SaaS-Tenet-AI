CORREÇÃO FINAL: A rota google_calendar.py ainda usa settings que está vazio. Precisa usar os.environ igual ao serviço.

=== ARQUIVO: app/routes/google_calendar.py ===

ADICIONE no início, após os imports existentes:

import os

SUBSTITUA a função get_auth_url INTEIRA por:

@router.get("/auth/url")
async def get_auth_url(current_user: dict = Depends(get_current_user)):
    """Retorna URL de autorização do Google."""
    tenet_id = current_user.get("agencia_id")
    if not tenet_id:
        raise HTTPException(status_code=400, detail="Usuário não vinculado a um Tenet")
    
    # Verificar diretamente do ambiente (igual ao serviço)
    client_id = os.environ.get("GOOGLE_CLIENT_ID", "")
    client_secret = os.environ.get("GOOGLE_CLIENT_SECRET", "")
    
    if not client_id or not client_secret:
        raise HTTPException(status_code=400, detail="Credenciais do Google não configuradas")
    
    try:
        auth_url = google_calendar_service.get_authorization_url(tenet_id)
        return {"auth_url": auth_url}
    except ValueError as e:
        logger.error(f"ValueError: {e}")
        raise HTTPException(status_code=400, detail=str(e))
    except Exception as e:
        logger.error(f"Erro ao gerar URL de auth: {e}")
        raise HTTPException(status_code=500, detail=f"Erro ao gerar URL: {str(e)}")


SUBSTITUA também a função get_calendar_status INTEIRA por:

@router.get("/status")
async def get_calendar_status(current_user: dict = Depends(get_current_user)):
    """Retorna status da integração com Google Calendar."""
    tenet_id = current_user.get("agencia_id")
    if not tenet_id:
        raise HTTPException(status_code=400, detail="Usuário não vinculado a um Tenet")
    
    # Verificar diretamente do ambiente
    client_id = os.environ.get("GOOGLE_CLIENT_ID", "")
    client_secret = os.environ.get("GOOGLE_CLIENT_SECRET", "")
    
    if not client_id or not client_secret:
        return {"connected": False, "reason": "credentials_not_configured"}
    
    try:
        supabase = get_supabase_client()
        result = supabase.table("google_calendar_integrations").select(
            "google_email, is_active, created_at, updated_at"
        ).eq("tenet_id", tenet_id).execute()
        
        if result.data and result.data[0].get("is_active"):
            return {
                "connected": True,
                "email": result.data[0].get("google_email"),
                "connected_at": result.data[0].get("created_at")
            }
        
        return {"connected": False}
        
    except Exception as e:
        logger.error(f"Erro ao verificar status: {e}")
        return {"connected": False, "error": str(e)}