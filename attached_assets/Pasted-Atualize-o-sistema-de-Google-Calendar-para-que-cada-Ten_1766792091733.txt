Atualize o sistema de Google Calendar para que cada Tenet configure suas pr√≥prias credenciais.

=== ARQUIVO: app/services/google_calendar_service.py ===

Atualize o m√©todo get_authorization_url para receber credenciais do banco:

async def get_authorization_url(self, tenet_id: str) -> dict:
    """Gera URL de autoriza√ß√£o OAuth2 usando credenciais do tenet."""
    try:
        supabase = get_supabase_client()
        
        # Buscar credenciais do tenet
        result = supabase.table("google_calendar_integrations").select(
            "google_client_id_encrypted, google_client_secret_encrypted"
        ).eq("tenet_id", tenet_id).execute()
        
        if not result.data or not result.data[0].get("google_client_id_encrypted"):
            return {"success": False, "error": "Credenciais do Google n√£o configuradas"}
        
        client_id = self.encryption.decrypt(result.data[0]["google_client_id_encrypted"])
        client_secret = self.encryption.decrypt(result.data[0]["google_client_secret_encrypted"])
        
        # Buscar redirect_uri do ambiente ou usar padr√£o
        redirect_uri = settings.GOOGLE_REDIRECT_URI or f"{settings.BASE_URL}/api/calendar/auth/callback"
        
        flow = Flow.from_client_config(
            {
                "web": {
                    "client_id": client_id,
                    "client_secret": client_secret,
                    "auth_uri": "https://accounts.google.com/o/oauth2/auth",
                    "token_uri": "https://oauth2.googleapis.com/token",
                    "redirect_uris": [redirect_uri]
                }
            },
            scopes=SCOPES
        )
        flow.redirect_uri = redirect_uri
        
        authorization_url, state = flow.authorization_url(
            access_type='offline',
            include_granted_scopes='true',
            state=tenet_id,
            prompt='consent'
        )
        
        return {"success": True, "auth_url": authorization_url}
        
    except Exception as e:
        logger.error(f"Erro ao gerar URL: {e}")
        return {"success": False, "error": str(e)}


=== ARQUIVO: app/routes/google_calendar.py ===

Adicione rota para salvar credenciais:

class GoogleCredentialsUpdate(BaseModel):
    client_id: str
    client_secret: str


@router.post("/credentials")
async def save_google_credentials(
    credentials: GoogleCredentialsUpdate,
    current_user: dict = Depends(get_current_user)
):
    """Salva credenciais do Google para o Tenet."""
    tenet_id = current_user.get("tenet_id")
    if not tenet_id:
        raise HTTPException(status_code=400, detail="Usu√°rio n√£o vinculado a um Tenet")
    
    try:
        from app.utils.security import EncryptionService
        encryption = EncryptionService()
        
        supabase = get_supabase_client()
        
        data = {
            "tenet_id": tenet_id,
            "google_client_id_encrypted": encryption.encrypt(credentials.client_id),
            "google_client_secret_encrypted": encryption.encrypt(credentials.client_secret),
            "updated_at": datetime.utcnow().isoformat()
        }
        
        # Upsert
        existing = supabase.table("google_calendar_integrations").select("id").eq("tenet_id", tenet_id).execute()
        
        if existing.data:
            supabase.table("google_calendar_integrations").update(data).eq("tenet_id", tenet_id).execute()
        else:
            data["created_at"] = datetime.utcnow().isoformat()
            supabase.table("google_calendar_integrations").insert(data).execute()
        
        return {"success": True, "message": "Credenciais salvas com sucesso"}
        
    except Exception as e:
        logger.error(f"Erro ao salvar credenciais: {e}")
        raise HTTPException(status_code=500, detail=str(e))


@router.get("/credentials/status")
async def get_credentials_status(current_user: dict = Depends(get_current_user)):
    """Verifica se as credenciais do Google est√£o configuradas."""
    tenet_id = current_user.get("tenet_id")
    if not tenet_id:
        raise HTTPException(status_code=400, detail="Usu√°rio n√£o vinculado a um Tenet")
    
    try:
        supabase = get_supabase_client()
        result = supabase.table("google_calendar_integrations").select(
            "google_client_id_encrypted"
        ).eq("tenet_id", tenet_id).execute()
        
        has_credentials = bool(result.data and result.data[0].get("google_client_id_encrypted"))
        
        return {"configured": has_credentials}
        
    except Exception as e:
        logger.error(f"Erro ao verificar credenciais: {e}")
        raise HTTPException(status_code=500, detail=str(e))


Atualize a rota /auth/url:

@router.get("/auth/url")
async def get_auth_url(current_user: dict = Depends(get_current_user)):
    """Retorna URL de autoriza√ß√£o do Google."""
    tenet_id = current_user.get("tenet_id")
    if not tenet_id:
        raise HTTPException(status_code=400, detail="Usu√°rio n√£o vinculado a um Tenet")
    
    try:
        result = await google_calendar_service.get_authorization_url(tenet_id)
        
        if not result.get("success"):
            raise HTTPException(status_code=400, detail=result.get("error", "Erro ao gerar URL"))
        
        return {"auth_url": result.get("auth_url")}
        
    except HTTPException:
        raise
    except Exception as e:
        logger.error(f"Erro ao gerar URL de auth: {e}")
        raise HTTPException(status_code=500, detail=str(e))


=== FRONTEND: Adicionar se√ß√£o de credenciais e tutorial ===

Na p√°gina de Integra√ß√µes, SUBSTITUA a se√ß√£o do Google Calendar por:

// ========================================
// ESTADOS ADICIONAIS
// ========================================
const [showGoogleTutorial, setShowGoogleTutorial] = useState(false);
const [googleCredentials, setGoogleCredentials] = useState({
  client_id: '',
  client_secret: ''
});
const [credentialsConfigured, setCredentialsConfigured] = useState(false);

// ========================================
// CARREGAR STATUS DAS CREDENCIAIS
// ========================================
const loadCredentialsStatus = async () => {
  try {
    const response = await api.get('/calendar/credentials/status');
    setCredentialsConfigured(response.data.configured);
  } catch (error) {
    console.error('Erro ao verificar credenciais:', error);
  }
};

// Chamar no useEffect
useEffect(() => {
  loadCredentialsStatus();
  // ... outros loads
}, []);

// ========================================
// SALVAR CREDENCIAIS
// ========================================
const handleSaveGoogleCredentials = async () => {
  if (!googleCredentials.client_id || !googleCredentials.client_secret) {
    setMessage({ type: 'error', text: 'Preencha todas as credenciais' });
    return;
  }
  
  setLoading(true);
  try {
    await api.post('/calendar/credentials', googleCredentials);
    setMessage({ type: 'success', text: 'Credenciais salvas com sucesso!' });
    setCredentialsConfigured(true);
    setGoogleCredentials({ client_id: '', client_secret: '' });
  } catch (error) {
    setMessage({ type: 'error', text: 'Erro ao salvar credenciais' });
  }
  setLoading(false);
};

// ========================================
// JSX - SE√á√ÉO GOOGLE CALENDAR COMPLETA
// ========================================
<div className="bg-white rounded-lg shadow p-6 mb-6">
  <div className="flex items-center justify-between mb-4">
    <div className="flex items-center gap-3">
      <div className="p-2 bg-red-100 rounded-lg">
        <svg className="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
      </div>
      <div>
        <h3 className="text-lg font-semibold">Google Calendar</h3>
        <p className="text-sm text-gray-500">Conecte sua agenda para agendamento autom√°tico de reuni√µes</p>
      </div>
    </div>
    
    {/* Bot√£o de ajuda/tutorial */}
    <button
      onClick={() => setShowGoogleTutorial(!showGoogleTutorial)}
      className="flex items-center gap-1 px-3 py-1 text-sm text-blue-600 hover:bg-blue-50 rounded-lg"
    >
      <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      Como configurar?
    </button>
  </div>
  
  {/* Tutorial expand√≠vel */}
  {showGoogleTutorial && (
    <div className="mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
      <h4 className="font-semibold text-blue-800 mb-3">üìã Passo a passo para configurar o Google Calendar</h4>
      
      <ol className="space-y-3 text-sm text-blue-700">
        <li className="flex gap-2">
          <span className="font-bold">1.</span>
          <div>
            Acesse o <a href="https://console.cloud.google.com/" target="_blank" rel="noopener noreferrer" className="underline font-medium">Google Cloud Console</a>
          </div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">2.</span>
          <div>Crie um novo projeto ou selecione um existente</div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">3.</span>
          <div>
            V√° em <strong>APIs e Servi√ßos</strong> ‚Üí <strong>Biblioteca</strong> ‚Üí Pesquise por <strong>"Google Calendar API"</strong> ‚Üí Clique em <strong>Ativar</strong>
          </div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">4.</span>
          <div>
            V√° em <strong>APIs e Servi√ßos</strong> ‚Üí <strong>Credenciais</strong> ‚Üí <strong>Criar Credenciais</strong> ‚Üí <strong>ID do cliente OAuth</strong>
          </div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">5.</span>
          <div>
            Se pedido, configure a <strong>Tela de Consentimento OAuth</strong>:
            <ul className="ml-4 mt-1 list-disc">
              <li>Tipo: Externo</li>
              <li>Nome do app: Seu nome de prefer√™ncia</li>
              <li>Email de suporte: Seu email</li>
            </ul>
          </div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">6.</span>
          <div>
            Na cria√ß√£o do ID do cliente OAuth:
            <ul className="ml-4 mt-1 list-disc">
              <li>Tipo: <strong>Aplicativo Web</strong></li>
              <li>Nome: TENET AI Calendar</li>
              <li>Origens JavaScript autorizadas: <code className="bg-blue-100 px-1 rounded">https://saasmultiagentesdr-production.up.railway.app</code></li>
              <li>URIs de redirecionamento: <code className="bg-blue-100 px-1 rounded">https://saasmultiagentesdr-production.up.railway.app/api/calendar/auth/callback</code></li>
            </ul>
          </div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">7.</span>
          <div>Clique em <strong>Criar</strong> e copie o <strong>Client ID</strong> e <strong>Client Secret</strong></div>
        </li>
        
        <li className="flex gap-2">
          <span className="font-bold">8.</span>
          <div>Cole as credenciais nos campos abaixo e clique em <strong>Salvar Credenciais</strong></div>
        </li>
      </ol>
      
      <div className="mt-4 p-3 bg-yellow-100 rounded-lg">
        <p className="text-yellow-800 text-sm">
          <strong>‚ö†Ô∏è Importante:</strong> Enquanto seu app estiver em "Teste" no Google, adicione os emails que poder√£o usar a integra√ß√£o em "Usu√°rios de teste" na Tela de Consentimento.
        </p>
      </div>
    </div>
  )}
  
  {/* Status das credenciais */}
  <div className={`flex items-center gap-2 p-3 rounded-lg mb-4 ${credentialsConfigured ? 'bg-green-50' : 'bg-yellow-50'}`}>
    <span className={`w-3 h-3 rounded-full ${credentialsConfigured ? 'bg-green-500' : 'bg-yellow-500'}`}></span>
    <span className={credentialsConfigured ? 'text-green-700' : 'text-yellow-700'}>
      {credentialsConfigured ? 'Credenciais configuradas' : 'Credenciais n√£o configuradas'}
    </span>
  </div>
  
  {/* Formul√°rio de credenciais */}
  {!credentialsConfigured && (
    <div className="space-y-4 mb-4 p-4 bg-gray-50 rounded-lg">
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Client ID
        </label>
        <input
          type="text"
          value={googleCredentials.client_id}
          onChange={(e) => setGoogleCredentials({...googleCredentials, client_id: e.target.value})}
          placeholder="Cole o Client ID do Google aqui"
          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
        />
      </div>
      
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-1">
          Client Secret
        </label>
        <input
          type="password"
          value={googleCredentials.client_secret}
          onChange={(e) => setGoogleCredentials({...googleCredentials, client_secret: e.target.value})}
          placeholder="Cole o Client Secret do Google aqui"
          className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-sm"
        />
      </div>
      
      <button
        onClick={handleSaveGoogleCredentials}
        disabled={loading || !googleCredentials.client_id || !googleCredentials.client_secret}
        className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50"
      >
        {loading ? 'Salvando...' : 'Salvar Credenciais'}
      </button>
    </div>
  )}
  
  {/* Bot√£o para reconfigurar credenciais */}
  {credentialsConfigured && !calendarStatus.connected && (
    <button
      onClick={() => setCredentialsConfigured(false)}
      className="text-sm text-gray-500 hover:text-gray-700 mb-4"
    >
      Alterar credenciais
    </button>
  )}
  
  {/* Status da conex√£o e bot√£o de conectar */}
  {credentialsConfigured && (
    <>
      {calendarStatus.connected ? (
        <div className="space-y-4">
          <div className="flex items-center gap-2 p-4 bg-green-50 rounded-lg">
            <span className="w-3 h-3 bg-green-500 rounded-full"></span>
            <span className="text-green-700">Conectado</span>
            <span className="text-green-600 font-medium">{calendarStatus.email}</span>
          </div>
          
          <button
            onClick={handleDisconnectCalendar}
            className="px-4 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50"
          >
            Desconectar Google Calendar
          </button>
        </div>
      ) : (
        <button
          onClick={handleConnectCalendar}
          className="flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50"
        >
          <img src="https://www.gstatic.com/images/branding/product/2x/calendar_48dp.png" alt="Google Calendar" className="w-5 h-5" />
          Conectar Google Calendar
        </button>
      )}
    </>
  )}
</div>